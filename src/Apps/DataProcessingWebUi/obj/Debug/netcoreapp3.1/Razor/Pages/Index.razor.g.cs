#pragma checksum "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "27b73d8cc70e909f50a02fb176089c897abc4539"
// <auto-generated/>
#pragma warning disable 1591
namespace DataProcessingWebUi.Pages
{
    #line hidden
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\_Imports.razor"
using DataProcessingWebUi;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\_Imports.razor"
using DataProcessingWebUi.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using Utils = CoreUtils.Classes.Utils;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using Newtonsoft.Json.Converters;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using System.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using System;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using System.Dynamic;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using System.Globalization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using System.Net.Http.Headers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using System.Threading;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using CoreUtils.Classes;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using Microsoft.VisualBasic.CompilerServices;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using Syncfusion.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
using Syncfusion.Blazor.Grids;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/")]
    public partial class Index : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.AddMarkupContent(0, "<h1>File And Data Processing App</h1>\r\n\r\n");
            __builder.AddMarkupContent(1, "<p class=\"lead\">This App automates File and Data Processing for Alegeus and COBRA Source Files.</p>\r\n");
            __builder.AddMarkupContent(2, "<p class=\"lead\">It also fetches Result &amp; Error Files from Alegeus and allows easy tracking </p>\r\n\r\n");
            __builder.OpenElement(3, "div");
            __builder.AddAttribute(4, "class", true);
            __builder.AddMarkupContent(5, "\r\n    ");
            __builder.OpenElement(6, "div");
            __builder.AddAttribute(7, "class", true);
            __builder.AddMarkupContent(8, "\r\n        ");
            __builder.OpenElement(9, "p");
            __builder.AddMarkupContent(10, "\r\n            &nbsp;");
            __builder.OpenElement(11, "button");
            __builder.AddAttribute(12, "id", "cmdCopyTestFiles");
            __builder.AddAttribute(13, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 25 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                                                          cmdCopyTestFiles

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(14, "CopyTestFiles");
            __builder.CloseElement();
            __builder.AddMarkupContent(15, "\r\n            &nbsp;&nbsp;&nbsp;&nbsp; Copy test files BEFORE starting a new process\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(16, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(17, "\r\n    ");
            __builder.AddMarkupContent(18, "<div class>\r\n        <p>\r\n\r\n        </p>\r\n    </div>\r\n    ");
            __builder.OpenElement(19, "div");
            __builder.AddAttribute(20, "class", true);
            __builder.AddMarkupContent(21, "\r\n        ");
            __builder.OpenElement(22, "p");
            __builder.AddMarkupContent(23, "\r\n            &nbsp;\r\n            ");
            __builder.OpenElement(24, "button");
            __builder.AddAttribute(25, "id", "cmdProcessCobraFiles");
            __builder.AddAttribute(26, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 37 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                                                        cmdProcessCobraFiles

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(27, "ProcessCobraFiles");
            __builder.CloseElement();
            __builder.AddMarkupContent(28, "\r\n            &nbsp;&nbsp;&nbsp;&nbsp; Process COBRA Source Files\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(29, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(30, "\r\n    ");
            __builder.OpenElement(31, "div");
            __builder.AddAttribute(32, "class", true);
            __builder.AddMarkupContent(33, "\r\n        ");
            __builder.OpenElement(34, "p");
            __builder.AddMarkupContent(35, "\r\n\r\n            &nbsp;\r\n            ");
            __builder.OpenElement(36, "button");
            __builder.AddAttribute(37, "id", "cmdProcessAlegeusFiles");
            __builder.AddAttribute(38, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 45 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                                                          cmdProcessAlegeusFiles

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(39, "ProcessAlegeusFiles");
            __builder.CloseElement();
            __builder.AddMarkupContent(40, "\r\n            &nbsp;&nbsp;&nbsp;&nbsp; Process Alegeus Source Files\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(41, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(42, "\r\n    ");
            __builder.OpenElement(43, "div");
            __builder.AddAttribute(44, "class", true);
            __builder.AddMarkupContent(45, "\r\n        ");
            __builder.OpenElement(46, "p");
            __builder.AddMarkupContent(47, "\r\n\r\n            &nbsp;\r\n            ");
            __builder.OpenElement(48, "button");
            __builder.AddAttribute(49, "id", "cmdRetrieveFtpErrorLogs");
            __builder.AddAttribute(50, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 53 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                                                           cmdRetrieveFtpErrorLogs

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(51, "RetrieveFtpErrorLogs");
            __builder.CloseElement();
            __builder.AddMarkupContent(52, "\r\n            &nbsp;&nbsp;&nbsp;&nbsp;Get Alegeus Upload Results\r\n\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(53, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(54, "\r\n    ");
            __builder.OpenElement(55, "div");
            __builder.AddAttribute(56, "class", true);
            __builder.AddMarkupContent(57, "\r\n        ");
            __builder.OpenElement(58, "p");
            __builder.AddMarkupContent(59, "\r\n\r\n            &nbsp;\r\n            ");
            __builder.OpenElement(60, "button");
            __builder.AddAttribute(61, "id", "cmdOpenAccessDB");
            __builder.AddAttribute(62, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 62 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                                                   cmdOpenAccessDB

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(63, "Open Access UI");
            __builder.CloseElement();
            __builder.AddMarkupContent(64, "\r\n            &nbsp;&nbsp;&nbsp;&nbsp; Open MS Access User Interface\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(65, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(66, "\r\n    ");
            __builder.OpenElement(67, "div");
            __builder.AddAttribute(68, "class", true);
            __builder.AddMarkupContent(69, "\r\n        ");
            __builder.OpenElement(70, "p");
            __builder.AddMarkupContent(71, "\r\n\r\n            &nbsp;\r\n            ");
            __builder.OpenElement(72, "button");
            __builder.AddAttribute(73, "id", "cmdShowJobs");
            __builder.AddAttribute(74, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 70 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                                               cmdShowJobStatus

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(75, "Show Job Status");
            __builder.CloseElement();
            __builder.AddMarkupContent(76, "\r\n            &nbsp;&nbsp;&nbsp;&nbsp; Show Job Status\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(77, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(78, "\r\n    ");
            __builder.AddMarkupContent(79, "<p>\r\n        Logs\r\n    </p>\r\n");
            __builder.CloseElement();
            __builder.AddMarkupContent(80, "\r\n");
            __builder.OpenElement(81, "div");
            __builder.AddAttribute(82, "class", true);
            __builder.AddMarkupContent(83, "\r\n    ");
            __Blazor.DataProcessingWebUi.Pages.Index.TypeInference.CreateSfGrid_0(__builder, 84, 85, 
#nullable restore
#line 79 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                                     Logs

#line default
#line hidden
#nullable disable
            , 86, "300px", 87, (__value) => {
#nullable restore
#line 79 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                  Grid = __value;

#line default
#line hidden
#nullable disable
            }
            );
            __builder.AddMarkupContent(88, "\r\n");
            __builder.CloseElement();
            __builder.AddMarkupContent(89, "\r\n");
            __builder.AddMarkupContent(90, "<div class>\r\n    <p>\r\n\r\n\r\n    </p>\r\n</div>\r\n");
            __builder.AddMarkupContent(91, "<div class>\r\n    <p>\r\n\r\n\r\n    </p>\r\n</div>\r\n");
            __builder.OpenElement(92, "div");
            __builder.AddAttribute(93, "class", true);
            __builder.AddMarkupContent(94, "\r\n    ");
            __builder.OpenElement(95, "p");
            __builder.AddMarkupContent(96, "\r\n        ");
            __builder.OpenElement(97, "textarea");
            __builder.AddAttribute(98, "Id", "ResultTextArea");
            __builder.AddAttribute(99, "Name", "ResultTextArea");
            __builder.AddAttribute(100, "AutoSize", "true");
            __builder.AddAttribute(101, "style", "width: 100%; max-width: 100%; height: 400px;max-height: 600px");
            __builder.AddAttribute(102, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 95 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                         ResultTextAreaValue

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(103, "oninput", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => ResultTextAreaValue = __value, ResultTextAreaValue));
            __builder.SetUpdatesAttributeName("value");
            __builder.AddMarkupContent(104, "\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(105, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(106, "\r\n");
            __builder.CloseElement();
            __builder.AddMarkupContent(107, "\r\n");
            __builder.AddMarkupContent(108, "<div class>\r\n    <p>\r\n\r\n\r\n    </p>\r\n</div>");
        }
        #pragma warning restore 1998
#nullable restore
#line 113 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"

    private string _username = "dataprocessinguser";
    

#line default
#line hidden
#nullable disable
#nullable restore
#line 115 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                                                 
    private string _password = "#gjgB0AXG^940";
    

#line default
#line hidden
#nullable disable
#nullable restore
#line 117 "E:\FileAndDataProcessingAndErrorLog\src\Apps\DataProcessingWebUi\Pages\Index.razor"
                                                 

    SfGrid<LogFields> Grid { get; set; }
    public string ResultTextAreaValue { get; set; } = String.Empty;

    private Boolean needsRefresh = false;

    private string strBaseUrl = "http://be015:81";


    private List<LogFields> Logs = new List<LogFields> { };

    private void addAuthHeader(HttpClient client)
    {
        string creds = $"{_username}:{_password}";
        AuthenticationHeaderValue authHeaderValue = new AuthenticationHeaderValue("basic", creds);
        client.DefaultRequestHeaders.Authorization = authHeaderValue;
    }


    public object SendRequest(string path, string arg)
    {
        try
        {

            StateHasChanged();

            HttpClient client = new HttpClient { BaseAddress = new Uri($"{strBaseUrl}"), Timeout = TimeSpan.FromSeconds(600) };

            // add auth header
            this.addAuthHeader(client);

            //HTTP GET Async
            var result = client.GetAsync($"/DataProcessing/{path}/{arg}").Result;

            if (!result.IsSuccessStatusCode)
            {
                //log response status here..
                throw new Exception($"{result.ReasonPhrase} {result.RequestMessage}");
            }

            // parse job ID
            var content = result.Content.ReadAsStringAsync().Result;

            //
            if (path.ToLower() != "JobResults".ToLower())
            {

                var converter = new ExpandoObjectConverter();
                dynamic taskJobDetails = JsonConvert.DeserializeObject<ExpandoObject>(content, converter);

                string jobId = (string)taskJobDetails.JobId;

                // get jobResult
                Boolean jobIsProcessing = true;

                // loop till job is processing - write to log : processing

                while (jobIsProcessing)
                {
                    // get result of the job started by the request
                    dynamic jobDetailsRequestResult = this.SendRequest("JobResults", $"{jobId}");
                    var jobDetailsContent = jobDetailsRequestResult.Content.ReadAsStringAsync().Result;
                    //
                    dynamic jobDetails = JsonConvert.DeserializeObject<ExpandoObject>(jobDetailsContent, converter);
                    //
                    string jobState = jobDetails != null ? jobDetails.JobState : "error";

                    // check job state

                    switch (jobState.ToLower())
                    {
                        case @"processing":
                        case @"started":
                        case @"enqueued":
                            var logItem = new LogFields(
                                DateTime.Now.ToString(CultureInfo.InvariantCulture),
                                "",
                                arg,
                                jobState,
                                "",
                                ""
                                );

                            this.Log(logItem);
                            //
                            Thread.Sleep(1000);
                            break;

                        default:
                            jobIsProcessing = false;

                            var logItem2 = new LogFields(
                                DateTime.Now.ToString(CultureInfo.InvariantCulture),
                                "",
                                arg,
                                jobState,
                                "",
                                Utils.IsBlank(jobDetails?.JobErrorDetails) ? jobDetails?.JobResultDetails : jobDetails?.JobErrorDetails
                                );

                            this.Log(logItem2);
                            result = jobDetailsRequestResult;
                            break;
                    }

                }

            }
            return result;
        }
        catch (Exception ex)
        {
            var logItem2 = new LogFields(
                DateTime.Now.ToString(CultureInfo.InvariantCulture),
                "",
                arg,
                "ERROR",
                "",
                new OperationResult("0", "200","ERROPR", "", ex.ToString()).ToString()
                );

            this.Log(logItem2);
            return null;
        }
    }

    void cmdCopyTestFiles()
    {
        this.Clear();

        this.Grid.Refresh();
        //
        dynamic result = this.SendRequest("StartJob", "copytestfiles");

    }

    void cmdProcessCobraFiles()
    {
        this.Clear();

        //
        dynamic result = this.SendRequest("StartJob", "processcobrafiles");
    }

    void cmdProcessAlegeusFiles()
    {
        this.Clear();

        //
        dynamic result = this.SendRequest("StartJob", "processalegeusfiles");
    }

    void cmdRetrieveFtpErrorLogs()
    {
        this.Clear();
        //
        dynamic result = this.SendRequest("StartJob", "retrieveftperrorlogs");
    }

    void cmdOpenAccessDB()
    {
        this.Clear();

    }

    void cmdShowJobStatus()
    {
        jsRuntime.InvokeAsync<object>("open", $"{strBaseUrl}/hangfire/jobs/processing", "_blank");
    }

    void Clear()
    {
        this.Logs.Clear();
        this.ResultTextAreaValue = "";
        this.Grid.Refresh();
        //
        this.needsRefresh = true;
        //
        StateHasChanged();
        //
        this.needsRefresh = false;
    }

    void Log(LogFields logItem)
    {
        this.Logs.Add(logItem);
        this.Grid.Refresh();

        if (!Utils.IsBlank(logItem.OutcomeDetails))
        {
            var converter = new ExpandoObjectConverter();
            OperationResult details = (OperationResult)Utils.DeserializeJson<OperationResult>(logItem.OutcomeDetails);
            if (!Utils.IsBlank(details.Error))
            {
                this.ResultTextAreaValue = details.Error;
            }
            else
            {
                this.ResultTextAreaValue = details.Details;
            }
        }
        this.needsRefresh = true;
        StateHasChanged();

    }


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime jsRuntime { get; set; }
    }
}
namespace __Blazor.DataProcessingWebUi.Pages.Index
{
    #line hidden
    internal static class TypeInference
    {
        public static void CreateSfGrid_0<TValue>(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder, int seq, int __seq0, global::System.Collections.Generic.IEnumerable<TValue> __arg0, int __seq1, global::System.String __arg1, int __seq2, global::System.Action<global::Syncfusion.Blazor.Grids.SfGrid<TValue>> __arg2)
        {
        __builder.OpenComponent<global::Syncfusion.Blazor.Grids.SfGrid<TValue>>(seq);
        __builder.AddAttribute(__seq0, "DataSource", __arg0);
        __builder.AddAttribute(__seq1, "Height", __arg1);
        __builder.AddComponentReferenceCapture(__seq2, (__value) => { __arg2((global::Syncfusion.Blazor.Grids.SfGrid<TValue>)__value); });
        __builder.CloseComponent();
        }
    }
}
#pragma warning restore 1591
